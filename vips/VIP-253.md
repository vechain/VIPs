---
VIP: 253
Title: Upgrade consensus to Delegated Proof of Stake (DPoS)
Description: Specification of the VeChainThor consensus mechanism upgrade to DPoS.
Author: Darren Kelly (@darrenvechain), Miguel Rojo (@freemanzMrojo), Tony Li (@libotony), Neil Brett (@nwbrettski), Pedro Gomes (@otherview) and Vanja Tomic (@vanja-vechain)
Discussions: https://vechain.discourse.group/t/add-vip-upgrade-consensus-to-delegated-proof-of-stake-dpos/551
Category: Core
Status: Draft
CreatedAt: 2025-07-28
---

## Overview

This VIP upgrades the existing Proof of Authority (PoA) consensus mechanism to a Delegated Proof of Stake (DPoS) consensus mechanism.

This document specifies the set of changes to the validator selection, block production and staking mechanisms.

## Motivation

While the current VeChainThor consensus mechanism PoA is efficient and scalable it restricts stakeholder participation to a set of authorized validators. As VeChain evolves towards greater decentralization and stakeholder participation, there is a growing need for a staking based consensus mechanism that enables broader stakeholder involvement.

Upgrading to a DPoS consensus mechanism will enable delegators, individual VET token holders, to participate in securing the VeChainThor network in a user-friendly, secure and compliant way. Increased levels of stakeholder participation will lead to higher levels of cryptoeconomic security of the VeChainThor blockchain.

## Rationale

The transition to DPoS is driven by the desire to advance the network’s decentralization, security, and inclusivity. The DPoS model empowers broader stakeholder involvement by enabling token holders to indirectly participate in consensus through delegation. This shift introduces several important benefits:

- **Increased Decentralization:** The validator set is no longer rigidly defined by central authority. Instead, it becomes dynamically determined by market-based staking, expanding the pool of potential validators and reducing reliance on trusted parties.
- **Enhanced Cryptoeconomic Security:** By allowing a wider base of VET holders to contribute their stake toward securing the network, DPoS increases the economic weight behind consensus, raising the cost of potential attacks and improving the overall resilience of the blockchain.
- **Validator Competition and Accountability:** With stake-weighted block production and the possibility of entry and exit from the validator set, performance and reputation become key to retaining delegations and rewards. This fosters greater validator accountability and operational excellence.

This consensus upgrade marks a strategic step toward realizing VeChain’s long-term vision of a secure, inclusive, and sustainable blockchain economy, where community alignment and participation are central to protocol integrity and innovation.

## Specification

### Definitions

- **Hayabusa:** The name of hardfork / upgrade that brings DPoS to VeChainThor.
- **Stake:** The quantity of hard-locked VET that either a validator or delegator commits to securing the network.
- **Staker:** A general term referring to an entity, validator or delegator, that has staked VET.
- **Stake Lock Period:** A commitment by a staker to hard lock their VET for a set duration of time.
- **Auto-Renewal:** A commitment by a staker to continue to hard lock their VET for recurring stake lock periods.
- **Validator:** An entity that stakes VET and contributes hardware to the network. Validators are responsible for verifying transactions, adding new blocks, and maintaining network security and integrity.
- **Delegator:** An entity that entrusts their VET to a validator to participate in the network consensus. The delegator role is restricted to a single delegator contract.
- **Delegator Contract:** A trusted intermediary that provides a staking interface for VET holders to manage their delegation positions.
- **Active Delegation Position:** VET that has been supplied by the delegator contract targeting a validator and is earning rewards.
- **Inactive Delegation Position:** VET that has been supplied by the delegator contract targeting a validator and is no longer earning rewards.
- **Queued Period:** A period of time when the validator is not participating in the leader group and is not earning rewards.
- **Reward Period:** A period of time when the validator is participating in the leader group and earning rewards.
- **Leader Group:** The set of validators currently elected to participate in the network’s consensus.
- **Active Validator:** A validator that is participating in the leader group with their active status set to true.
- **Inactive Validator:** A validator that is participating in the leader group with their active status set to false.
- **Prospective Validator:** A validator that has signalled their intent to participate in the network, but is not in the leader group.
- **On Cooldown Validator:** A validator that has completed their staking period. This validator is no longer part of the leader group and can no longer receive delegations.
- **Exited Validator:** A validator that can withdraw their stake and can no longer receive delegations.
- **Cooldown Period:** A set duration of time where a validator is queued to exit and can no longer receive delegations.
- **Epoch:** A collection of 180 blocks, expected to last 30 minutes or longer if slots are missed.
- **Exit Block:** A set block where a validator that is on cooldown can exit.
- **Endorser Account:** The account that provides staked VET and signs the staking operation.
- **Beneficiary Account:** An optional account that is assigned by the endorser account to receive block rewards on their behalf.
- **NodeID:** The public address of the validator node that proposes blocks..
- **ValidationID:** A unique identifier of a staking event by a validator.
- **DelegationID:** A unique identifier of a staking event by a delegator.
- **Reward Split:** The split of rewards between the validator and the delegators.
- **Probability Weights:** Multipliers that are assigned to each of the different staking entities staked VET.
- **Hayabusa Block:** A block, which aligns with the start of an epoch, which starts the Hayabusa Transition Period.
- **Hayabusa Transition Period:** A period of time for validators to signal their intention to transition from PoA to DPoS.
- **DPoS Requirements Check Block:** A check is performed on this block to determine if the network should transition from PoA to DPoS, if successful this block is the first block under DPoS consensus.

### Parameters

- **Mainnet Delegator Contract Address:** TBC - Subject to deployment of StarGate
- **Mainnet Executor Address:** 0x0000000000000000000000004578656375746f72
- **Validator Reward Split:** 30%
- **Delegator Pool Reward Split:** 70% 
- **Minimum Validator Stake:** 25m VET
- **Maximum Allowed Stake Per Validator:** 600m VET 
- **Block Production Probability Weights:**
   - 2x Validator (for a validator with delegations)
   - 1x Validator (for a validator without delegations)
   - 1.5x X-Node
   - 1x Eco Node 
- **Stake Lock Periods:**
   - 7 days / 60,480 blocks / 336 epochs
   - 15 days / 129,600 blocks / 720 epochs
   - 30 days / 259,200 blocks / 1,440 epochs
- **Cooldown Period:** 24 hours / 8,640 blocks / 48 epochs
- **Hayabusa Transition Period:** 7 days / 60,480 blocks / 336 epochs

### Hayabusa Transition (PoA -> DPoS)

<img width="903" alt="Image" src="https://github.com/user-attachments/assets/bdc60908-642f-4af0-a5a7-d28c6de56360" />

   Once the Hayabusa hardfork block is produced, hardfork_block+0, it initiates a Hayabusa transition period to start. Started from the transition block, VTHO generation by holding VET will discontinue. VTHO issuance by staking will start once transition period ends. During this 7-day (60,480 blocks) window, only existing PoA validators can interact with the DPoS staking contract. Existing PoA validators wishing to join the new DPoS network must submit a DPoS staking transaction.

When the transition period ends, at hardfork_block+60,480, the chain performs a DPoS requirements check to confirm two conditions:

- the transition period is complete
- at least two-thirds of existing PoA validators have staked with the DPoS staking contract

If the check is successful at hardfork_block+60,480 this block will be become the first DPoS block, and a new epoch begins under DPoS. If the check fails, a new Hayabusa transition period begins, and the process repeats until the criteria are satisfied.

### Validation

Under the current PoA consensus, the VeChainThor validator set is limited to 101 authorized validators, each of whom must follow defined procedures.

With the transition to DPoS consensus, the validator set will remain limited to 101 active validators. Any participant meeting the minimum staking requirement of 25m VET will be eligible to become a validator.

Validator admission will follow a first-in, first-out (FIFO) queueing mechanism. Validators who meet the staking requirement and submit a valid staking transaction enter the prospective validator queue. When a position becomes available in the active validator set, due to an exit, the next eligible validator in the queue is promoted to an active validator at the start of the next epoch.

Validators that are inactive for more than 7 days will be evicted from the leader group and placed on the exit queue.

### Delegation

Delegations will be restricted to a single entity the delegator contract. This delegator contract will serve as a single, trusted delegation layer that interfaces between individual delegators and the VeChainThor validator set. 

### Finality

Under the current PoA consensus, finality for an epoch is achieved after two rounds of Byzantine Fault Tolerance (BFT), where each round requires at least two-thirds of the leader group to propose a block within the epoch. Proposing a block is effectively a vote for finalizing the epoch.

With the transition to DPoS consensus, this mechanism requires modification. Unlike PoA, validator nodes in DPoS are no longer uniform in stake size. Relying on two-thirds of the validator count to propose a block within an epoch is less likely as validators may differ significantly in their quantity of staked VET.

To ensure a high likelihood of the network being able to achieve finality, the mechanism will be altered slightly. Finality will require more than two-thirds of the total weighted staked VET to have proposed a block within an epoch. This update aligns the finality mechanism with the stake-based nature of DPoS, maintaining both security and liveness in the consensus protocol.

### Block Production Likelihood

In the VeChainThor blockchain, under PoA consensus, validators do not compete to create blocks. Instead, they are selected through a random mechanism, ensuring equal, predictable and deterministic block production. Provided the validator set remains stable and no slots are missed. The sequence of block producers is known for the next 8,640 slots. 

Under DPoS consensus, a modification to block production will be introduced, making the likelihood of a validator producing a block proportional to the quantity of VET staked. Validators with higher total staked VET will have an increased likelihood of being selected to produce the next block. Delegations from different network participants will influence this likelihood, with different weights applied to different network participants.

#### Formula
$$P_{v} = \frac{W_{v} * S_{vs} + W_{x} * \sum S_{xd} + W_{e} * \sum S_{ed}}{\sum_{i=1}^{101}(W_{v} * S_{vs,i} + W_{x} * \sum S_{xd,i} + W_{e} \sum S_{ed,i})}$$

#### Variables
- **$P_{v}$:** Probability that validator $v$ is selected to produce a block.
- **$W_{v}$:** Valdiator weight.
- **$S_{vs}$:** VET Staked by validator $v$.
- **$W_{x}$:** X-Node weight.
- **$S_{xd}$:** Staked VET from X-Node delegations to validator $v$.
- **$W_{e}$:** Eco-Node weight.
- **$S_{ed}$:** Staked VET from Eco-Node delegations to validator $v$.
- **$\sum S_{xd}$:** Total staked VET from X-Node delegations to validator $v$.
- **$\sum S_{ed}$:** Total staked VET from Eco-Node delegations to validator $v$.

## Reference Implementation

### High Level Sequence Diagram

<img width="1151" alt="Image" src="https://github.com/user-attachments/assets/0d0b2ba5-e768-4d4d-aae8-6ccb17670340" />

A prospective validator stakes their VET as a security bond (1). Validators are chosen to propose blocks with a probability proportional to the total weight of staked VET (2). For each block proposed, the validator receives an emission of VTHO (3) and so do the delegators in that validator, payable to the delegator contract (4). Users can stake VET to the delegator contract and in turn stake with a validator making them eligible to claim a portion of the delegator rewards.

### Delegator Contract Trusted Intermediary

All delegation operations will be restricted to a single, trusted delegator contract intermediary.

### Validator Staking Identification

Unique validator identification is an important requirement to ensure that delegations are assigned to the correct validator. To generate a unique validator identification a validator’s endorser account will sign and issue a transaction requesting to create a stake in the network.

The create stake transaction must contain the following information:
   - **Stake:** The quantity of VET being committed to securing the network.
   - **Stake Lock Period:** The duration of time that the validator is committing to secure the network.
   - **Auto Renewal:** A binary option signalling the validators intent to automatically recommit to securing the network for the same stake lock period after the completion of the current stake lock period.
   - **NodeID:** The public address of the validator node that proposes blocks..

A validator's unique ValidationID is the outcome of a signed transaction `ValidationID = Sign(Endorsor Account, AddValidationTx(Stake, Staking Lock Period, Auto Renewal, NodeID))`. The create validator stake transaction must have a NodeID that is not in Queued, Active, or On Cooldown state.

### Delegation Position Identification 

Given the protocol does not have a direct connection to the VET holder that is delegating stake to the protocol it is important to have a unique identifier for delegation positions.

To generate a unique delegation position identification a delegation position stake transaction must contain the following information
   - **Stake:** The quantity of VET being committed to securing the network.
   - **Validation ID:** The validation id that the delegator intends to stake with.
   - **Auto Renewal:** A binary option signalling the validators intent to automatically recommit to securing the network for the same stake lock period after the completion of the current stake lock period.
   - **Multiplier:** A multiplier that will be applied to the stake to contribute to the block production likelihood.

A delegation position identification is calculated as an incremental counter. The create delegator position stake transaction must have a ValidationID that is not On Cooldown state.

### Validator Operations

#### Stake Lock Period

When joining the network, a validator specifies a stake lock period, the duration of time they commit to securing the network. This period aligns with the start and end of an epoch.

During the stake lock period, a validator may submit transactions to increase or decrease their stake, or to disable their auto-renewal setting.

#### Alter Stake

To increase their staked VET, the validator sends a transaction along with additional VET. The increased quantity of VET will take effect at the start of the next staking period. To decrease their stake, the validator submits a transaction signalling the desired reduction, also effective at the start of the next staking period. The reduced quantity of VET  becomes withdrawable once the current stake lock period ends.

#### Alter Auto-Renewal

When joining the VeChainThor network validators have their auto-renewal set to TRUE, meaning that the validator will automatically enter a new stake lock period of the same duration once the current stake lock period concludes. A validator can stop their auto-renewal by sending a transaction which will set auto-renewal to FALSE. If the auto-renewal is set to FALSE, the validator begins the exit process at the end of the current stake lock period. Once the auto-renewal is set to FALSE it is non reversible, the validator will exit at the end of the stake lock period.

### Validator Entry

<img width="865" alt="Image" src="https://github.com/user-attachments/assets/fc801d03-bc3d-4542-8645-cbe9e5a0d8d4" />

Prospective validators join the leader group on a First-In, First-Out (FIFO) basis, provided there is available capacity. Once a validator enters the leader group, their stake lock period begins and they are eligible to earn rewards. Validator joining is aligned to an epoch block.

### Validator Exit

<img width="749" alt="Image" src="https://github.com/user-attachments/assets/3fb95f5b-7092-458b-9cb6-ff043c036464" />

When an active validator submits an exit transaction and completes their staking period, they enter a cooldown period, which aligns with an epoch block. Only one validator can enter cooldown per epoch, this will be managed by a FIFO queue. When a validator enters the cooldown state, the validator is removed from the leader group and can no longer accept delegations, increase or decrease their staked VET or alter their auto-renewal setting. Delegators associated with a validator in the cooldown state can access their funds. Delegators in a fully exited validator are inactive and ineligible for rewards, and can withdraw their funds. The validator’s staked VET becomes withdrawable at the end of the cooldown period, the exit_epoch.

### Delegator Operations

All delegation operations modifying individual delegation positions are performed via the delegator contract.

#### Alter Auto-Renewal

When joining the VeChainThor network delegation positions have their auto-renewal set to TRUE, meaning that the delegation position will automatically enter a new stake lock period of the same duration once the current stake lock period concludes. A delegation position can stop their auto-renewal by sending a transaction which will set auto-renewal to FALSE. If the auto-renewal is set to FALSE, the delegation position begins the exit process at the end of the current stake lock period. Once the auto-renewal is set to false it is non reversible, the delegation position will exit at the end of the stake lock period.

An edge case exists where a delegation position auto-renewal setting of TRUE is superseded by the delegated to validator exiting. Given that the delegation position depends on the existence and participation of the delegated to validator if the validator exits all delegation positions associated with the validator become inactive, ineligible for rewards and associated delegation positions can withdraw their funds.

## Copyright
Copyright and related rights waived via CC0.
